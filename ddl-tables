drop table if exists user;
drop table if exists media;
drop table if exists friends;
drop table if exists currents;
drop table if exists reviews;

create table users (
    user_id int auto_increment,
    username varchar(20),
    email varchar(50),
    password_hash varchar,
    profile_pic varchar,
    primary key (user_id)
);

create table friends (
    user_id int not null,
    friend_id int not null,
    primary key (user_id, friend_id)

    --ref integ
    index(user_id)
    foreign key (user_id) references user(user_id)
        on update restrict
        on delete restrict
);

create table media(
    media_id int auto_increment,
    title varchar(50),
    media_type enum('movie', 'song', 'book'),
    director varchar(50),
    artist varchar(50),
    author varchar(50),
    primary key(media_id)
);

create table currents(
    current_id int auto_increment,
    user_id int not null,
    media_id int,
    progress varchar(50),
    primary key(current_id),

    --ref integ
    index(user_id, media_id)
    foreign key (user_id) references user(user_id)
        on update restrict
        on delete restrict
     foreign key (media_id) references media(media_id)
        on update restrict
        on delete restrict
);

create table reviews(
    review_id int auto_increment,
    media_id int,
    user_id int,
    review_text text,
    rating int,
    primary key(review_id),

    --ref integ
    foreign key (user_id) references user(user_id)
        on update restrict
        on delete restrict
     foreign key (media_id) references media(media_id)
        on update restrict
        on delete restrict
    
);
